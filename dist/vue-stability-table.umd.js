(function(u,g){typeof exports=="object"&&typeof module!="undefined"?module.exports=g():typeof define=="function"&&define.amd?define(g):(u=typeof globalThis!="undefined"?globalThis:u||self,u["vue-stability-table"]=g())})(this,function(){"use strict";const u={label:"",prop:"",subProp:"",align:"left",fixed:!1,key:"",resizable:!1,width:100,minWidth:80,maxWidth:null,formatter:null,sortable:!1,colClass:""};var g={columns:{type:Array},dataSource:{type:Array},sticky:{type:Boolean,default:!1},childrenColumnName:{type:String,default:"children"},indentSize:{type:Number,default:16},defaultExpandAllRows:{type:Boolean,default:!1},pagination:{type:[Boolean,Object],default:!1},rowClassName:{type:String,default:""},rowKey:{type:String,default:"id"},rowSize:{type:Number,default:40},expandSize:{type:Number,default:null},colSize:{type:Number,default:100},emptyText:{type:String,default:"\u6682\u65E0\u6570\u636E"},openIconColumn:{type:Number,default:0},scrollDisplayType:{type:String,default:"show"}},m={minBarSize:{type:Number,default:50},scrollTop:{type:[Number,Function],default:0},scrollLeft:{type:[Number,Function],default:0},displayType:{type:String,default:"hover"},offsetLeft:{type:Number,default:0},offsetRight:{type:Number,default:10},offsetTop:{type:Number,default:0},offsetBottom:{type:Number,default:10},isAutoUpdate:{type:Boolean,default:!0},dragSpeedX:{type:Number,default:1},dragSpeedY:{type:Number,default:1}},C=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{ref:"scrollBox",staticClass:"vue-agile-scrollbar",class:{"not-user-select":t.scrollBarX.clientX||t.scrollBarY.clientY,"scrollbar-hover":t.displayType==="hover","scrollbar-hide":t.displayType==="hide"}},[e("div",{ref:"scroll",staticClass:"agile-scroll-content",on:{scroll:t.onScroll}},[e("div",{ref:"scrollContent",staticClass:"agile-scroll-wrapper"},[t._t("default")],2)]),t.scrollBarX.show?e("div",{staticClass:"agile-scroll-bar-x",class:{act:t.scrollBarX.clientX||t.scrollBarY.clientY},style:{left:t.scrollBarX.left+"px",width:t.scrollBarX.width+"px",bottom:t.scrollBarX.bottom},on:{mousedown:function(i){return t.scrollBarDown(i,"scrollBarX")}}}):t._e(),t.scrollBarY.show?e("div",{staticClass:"agile-scroll-bar-y",class:{act:t.scrollBarY.clientY||t.scrollBarX.clientX},style:{top:t.scrollBarY.top+"px",height:t.scrollBarY.height+"px"},on:{mousedown:function(i){return t.scrollBarDown(i,"scrollBarY")}}}):t._e()])},B=[];function x(t,s,e,i,l,r,a,d){var o=typeof t=="function"?t.options:t;s&&(o.render=s,o.staticRenderFns=e,o._compiled=!0),i&&(o.functional=!0),r&&(o._scopeId="data-v-"+r);var n;if(a?(n=function(h){h=h||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!h&&typeof __VUE_SSR_CONTEXT__!="undefined"&&(h=__VUE_SSR_CONTEXT__),l&&l.call(this,h),h&&h._registeredComponents&&h._registeredComponents.add(a)},o._ssrRegister=n):l&&(n=d?function(){l.call(this,(o.functional?this.parent:this).$root.$options.shadowRoot)}:l),n)if(o.functional){o._injectStyles=n;var p=o.render;o.render=function(f,v){return n.call(v),p(f,v)}}else{var c=o.beforeCreate;o.beforeCreate=c?[].concat(c,n):[n]}return{exports:t,options:o}}const z={name:"vueAgileScrollBar",props:m,data(){return{scrollBarY:{show:!0,clientY:null,height:0,top:this.offsetTop,multiple:1},scrollBarX:{show:!0,clientX:null,width:0,bottom:0,left:this.offsetLeft,multiple:1},scrollWidth:0,scrollHeight:0,scrollContentWidth:0,scrollContentHeight:0}},watch:{offsetLeft(){this.setScrollBarLeft()},offsetRight(){this.setScrollBarLeft()},offsetTop(){this.setScrollBarTop()},offsetBottom(){this.setScrollBarTop()}},mounted(){this.$scrollBox=this.$refs.scrollBox,this.$scroll=this.$refs.scroll,this.$scrollContent=this.$refs.scrollContent,this.updated(),this.isAutoUpdate&&(this.observer=new MutationObserver(this.updated),this.observer.observe(this.$refs.scrollContent,{attributes:!0,childList:!0,subtree:!0})),this.addDragEvent()},methods:{initContainer(){this.scrollWidth=this.$scrollBox.offsetWidth,this.scrollHeight=this.$scrollBox.offsetHeight,this.scrollContentWidth=this.$scrollContent.offsetWidth,this.scrollContentHeight=this.$scrollContent.offsetHeight},initScrollBar(){if(this.scrollContentWidth>this.scrollWidth){const t=this.scrollWidth-(this.scrollContentWidth-this.scrollWidth)-this.offsetLeft-this.offsetRight;this.scrollBarX.show=!0,this.scrollBarX.width=t<this.minBarSize?this.minBarSize:t,this.scrollBarX.multiple=(this.scrollContentWidth-this.scrollWidth)/(this.scrollWidth-this.scrollBarX.width-this.offsetLeft-this.offsetRight)}else this.scrollBarX.show=!1;if(this.scrollContentHeight>this.scrollHeight){const t=this.scrollHeight-(this.scrollContentHeight-this.scrollHeight)-this.offsetTop-this.offsetBottom;this.scrollBarY.show=!0,this.scrollBarY.height=t<this.minBarSize?this.minBarSize:t,this.scrollBarY.multiple=(this.scrollContentHeight-this.scrollHeight)/(this.scrollHeight-this.scrollBarY.height-this.offsetTop-this.offsetBottom),this.scrollBarX.bottom=0}else this.scrollBarY.show=!1,this.scrollBarX.bottom=this.scrollHeight-this.scrollContentHeight+"px"},updated(){this.initContainer(),this.initScrollBar(),this.$emit("updated",{scrollBarY:this.scrollBarY.show,scrollBarX:this.scrollBarX.show,top:this.$scroll.scrollTop,left:this.$scroll.scrollLeft,scrollWidth:this.scrollWidth,scrollHeight:this.scrollHeight,scrollContentWidth:this.scrollContentWidth,scrollContentHeight:this.scrollContentHeight})},setScrollBarLeft(){const t=this.$scroll.scrollLeft,s=this.offsetLeft+Math.floor(t/this.scrollBarX.multiple);return s!==this.scrollBarX.left&&(this.scrollBarX.left=s),t},setScrollBarTop(){const t=this.$scroll.scrollTop,s=this.offsetTop+Math.floor(t/this.scrollBarY.multiple);return s!==this.scrollBarY.top&&(this.scrollBarY.top=s),t},onScroll(t){const s=this.setScrollBarTop(),e=this.setScrollBarLeft();this.$emit("scroll",{top:s,left:e,scrollWidth:this.scrollWidth,scrollHeight:this.scrollHeight,scrollContentWidth:this.scrollContentWidth,scrollContentHeight:this.scrollContentHeight},t),this._events["scroll-hit"]&&this.onScrollHit(s,e)},onScrollHit(t,s){let e="top",i=t-this.initTop,l=s-this.initLeft;this.initTop=t,this.initLeft=s;const r=()=>{this.$emit("scroll-hit",e,{top:t,left:s,scrollWidth:this.scrollWidth,scrollHeight:this.scrollHeight,scrollContentWidth:this.scrollContentWidth,scrollContentHeight:this.scrollContentHeight})};i!==0&&this.scrollBarY.height&&(i<0?e="top":e="bottom",this.scrollContentHeight-this.scrollHeight-t==0&&r(),t===0&&e==="top"&&r()),l!==0&&this.scrollBarX.width&&(l<0?e="left":e="right",s===0&&e==="left"||this.scrollContentWidth-this.scrollWidth-s==0||(e="xMiddle"),r())},scrollBarDown(t,s){s==="scrollBarX"&&(this.scrollBarX.clientX=t.clientX,this.scrollBarX.scrollLeft=this.$scroll.scrollLeft),s==="scrollBarY"&&(this.scrollBarY.clientY=t.clientY,this.scrollBarY.scrollTop=this.$scroll.scrollTop),window.addEventListener("mousemove",this.scrollBarDrag)},scrollBarDrag(t){const s=this.scrollBarX.clientX,e=this.scrollBarY.clientY;if(s){let i=t.clientX-s;this.$scroll.scrollLeft=this.scrollBarX.scrollLeft+i*(this.scrollBarX.multiple*this.dragSpeedX)}if(e){let i=t.clientY-e;this.$scroll.scrollTop=this.scrollBarY.scrollTop+i*this.scrollBarY.multiple*this.dragSpeedY}},scrollBarUp(){this.scrollBarX.clientX=null,this.scrollBarY.clientY=null,window.removeEventListener("mousemove",this.scrollBarDrag)},addDragEvent(){window.addEventListener("mouseup",this.scrollBarUp)},removeDragEvent(){window.removeEventListener("mouseup",this.scrollBarUp)}},beforeDestroy(){this.isAutoUpdate&&this.observer&&this.observer.disconnect(),this.removeDragEvent()}},S={};var $=x(z,C,B,!1,X,null,null,null);function X(t){for(let s in S)this[s]=S[s]}var R=function(){return $.exports}(),tt="";class k{constructor(s){this.opts=Object.assign({},{rowsNum:0,colsNum:0,rowSize:50,colSize:100,expandSize:null,fixedColNum:0,viewHeight:500,viewWidth:800},s),this.topDistance=0,this.rowStart=null,this.rowEnd=null,this.bottomDistance=0,this.leftDistance=0,this.colStart=null,this.colEnd=null,this.rightDistance=0,this.scrollTop=0,this.scrollLeft=0}getRowsRegion(s,e){if(this.opts.rowsNum<=50)return null;let i,l,r={top:0,middle:0,bottom:0};const a=this.opts.rowsNum,d=this.opts.rowSize,o=this.opts.viewHeight,n=Math.ceil(o/d);if(e){let p=this.topDistance;if(s>this.scrollTop){for(let c=this.rowStart||0;c<a;c++)if(p+=d+(e&&e[c]||0),p>=s){i=c,l=i+n;break}}if(s<this.scrollTop&&p>=s){let c=0;for(let f=this.rowStart;f<this.rowEnd;f++)c+=d+(e&&e[f]||0);let h=0;for(const f in e)f<this.rowEnd&&(h+=e[f]);l=Math.floor((s+c-h)/d),l<n&&(l=n),i=l-n}for(const c in e)c<i?r.top+=e[c]:c>l&&(r.bottom+=e[c])}else i=Math.floor(s/d),l=i+n;if(l>a&&(l=a),i<0&&(i=0),i!==void 0&&l!==void 0&&(i!==this.rowStart||l!==this.rowEnd))return this.scrollTop=s,this.rowStart=i,this.rowEnd=l,this.topDistance=this.rowStart*this.opts.rowSize+r.top,this.bottomDistance=(a-this.rowEnd)*this.opts.rowSize+r.bottom,{start:this.rowStart,end:this.rowEnd,top:this.topDistance,bottom:this.bottomDistance}}getRowsRegionBar(s,e){if(this.opts.rowsNum<=50)return null;let i,l,r={top:0,middle:0,bottom:0};const a=this.opts.rowsNum,d=this.opts.rowSize,o=this.opts.viewHeight,n=30,p=o/2;if(s<d*2)i=0,l=n;else if(s-this.scrollTop>p){let c=this.topDistance;for(let h=this.rowStart;h<a;h++)if(c+=d+(e&&e[h]||0),c>=s){i=h-Math.floor(n/3),l=i+n;break}}else if(this.scrollTop-s>p&&(this.topDistance+p>=s&&(i=this.rowStart-Math.floor(n/3),l=i+n),this.topDistance-s>100)){let h=this.topDistance;for(let f=this.rowStart;f>n;f--)if(h-=d+(e&&e[f]||0),h<=s){i=f-Math.floor(n/3),l=i+n;break}}if(e)for(const c in e)c<i?r.top+=e[c]:c>l&&(r.bottom+=e[c]);if(l>a&&(l=a),i<0&&(i=0),l<n&&(l=n),i!==void 0&&l!==void 0&&(i!==this.rowStart||l!==this.rowEnd))return this.scrollTop=s,this.rowStart=i,this.rowEnd=l,this.topDistance=this.rowStart*this.opts.rowSize+r.top,this.bottomDistance=(a-this.rowEnd)*this.opts.rowSize+r.bottom,{start:this.rowStart,end:this.rowEnd,top:this.topDistance,bottom:this.bottomDistance}}upRowsRegion(){const s=this.opts.rowsNum;return this.topDistance=this.rowStart*this.opts.rowSize,this.bottomDistance=(s>this.rowEnd?s-this.rowEnd:0)*this.opts.rowSize,{start:this.rowStart,end:this.rowEnd,top:this.topDistance,bottom:this.bottomDistance}}emptyRowsRegion(){this.rowStart=null,this.rowEnd=null}getColRegion(s){const e=this.opts.colSize,i=Math.floor(this.opts.viewWidth/e);if(this.opts.colsNum<=i*3)return null;let l,r,a;if(s<this.opts.viewWidth)l=0,r=i*2;else{l=Math.floor(s/e)-i;let d=l+i*3;r=d,d>this.opts.colsNum&&(r=this.opts.colsNum,this.rightDistance=0,a=!0)}if(this.scrollLeft=s,(l!==this.colStart||r!==this.colEnd)&&r-this.colEnd>5||this.colEnd-r>5||a)return this.colStart=l,this.colEnd=r,this.leftDistance=this.colStart*e,this.rightDistance=(this.opts.colsNum-this.colEnd)*e,{start:this.colStart,end:this.colEnd,left:this.leftDistance,right:this.rightDistance}}}var Y={data(){return{dragSize:{clientX:null,dWidth:0,height:0,rulerLeft:0,colItem:null}}},mounted(){this.addDragEvent()},methods:{dragSizeDown(t,s){this.dragSize.rulerLeft=t.clientX-this.$refs.tableBox.getBoundingClientRect().x,this.dragSize.height=this.$refs.scroll.scrollHeight,this.dragSize.clientX=t.clientX,this.dragSize.width=s.width,this.dragSize.colItem=s,this.dragSize.element=t.target,window.addEventListener("mousemove",this.dragSizeMove),this.dragSize.element.setAttribute("data-darg-act","true")},dragSizeMove(t){const s=this.dragSize.clientX;if(s){let e=t.clientX-s;this.dragSize.dWidth=e,this.$refs.dargSizeRuler.style.left=this.dragSize.rulerLeft+e+"px"}},dragSizeUp(){if(this.dragSize.clientX){this.dragSize.clientX=null,this.dragSize.element.setAttribute("data-darg-act","false");const t=this.dragSize.colItem.minWidth||u.minWidth;let s=this.dragSize.width+this.dragSize.dWidth;s<t&&(s=t),this.dragSize.colItem.width=s,window.removeEventListener("mousemove",this.dragSizeMove)}},addDragEvent(){window.addEventListener("mouseup",this.dragSizeUp)},removeDragEvent(){window.removeEventListener("mouseup",this.dragSizeUp)}},beforeDestroy(){this.removeDragEvent()}},T={data(){return{activeSort:"",sortOrders:""}},methods:{sortChange(t){if(t.sortable)if(!this.activeSort||!this.sortOrders||this.sortOrders==="desc"||t.prop!==this.activeSort?this.sortOrders="asc":this.sortOrders==="asc"&&(this.sortOrders="desc"),this.activeSort=t.prop,this._events["on-sort-change"])this.$emit("on-sort-change",t.prop,this.sortOrders,t);else{let s=this.dataSource.slice(0);this.sortOrders&&s.sort((e,i)=>{let l=e[t.prop],r=i[t.prop];return l===r?0:typeof l==typeof r&&this.sortOrders==="asc"?l<r?-1:1:l>r?-1:1}),this.virtualScrollY?(this.virtualScrollY=this.virtual.upRowsRegion(this.expand),this.rows=s.slice(this.virtualScrollY.start,this.virtualScrollY.end)):this.rows=s}}}},H=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("span",{staticClass:"stability-table-column-sorter"},[e("span",{staticClass:"stability-table-column-sorter-inner"},[e("span",{staticClass:"stability-table-column-sorter-up",class:{"sort-act":t.sort&&t.activeSort&&t.sort===t.activeSort&&t.sortOrders==="asc"},attrs:{role:"img"}},[e("svg",{attrs:{focusable:"false",width:"11",height:"11",fill:"currentColor","aria-hidden":"true",viewBox:"0 0 1024 1024"}},[e("path",{attrs:{d:"M858.9 689L530.5 308.2c-9.4-10.9-27.5-10.9-37 0L165.1 689c-12.2 14.2-1.2 35 18.5 35h656.8c19.7 0 30.7-20.8 18.5-35z"}})])]),e("span",{staticClass:"stability-table-column-sorter-down",class:{"sort-act":t.sort&&t.activeSort&&t.sort===t.activeSort&&t.sortOrders==="desc"},attrs:{role:"img"}},[e("svg",{attrs:{focusable:"false",width:"11",height:"11",fill:"currentColor","aria-hidden":"true",viewBox:"0 0 1024 1024"}},[e("path",{attrs:{d:"M840.4 300H183.6c-19.7 0-30.7 20.8-18.5 35l328.4 380.8c9.4 10.9 27.5 10.9 37 0L858.9 335c12.2-14.2 1.2-35-18.5-35z"}})])])])])},D=[],et="";function w(t,s,e,i,l,r,a,d){var o=typeof t=="function"?t.options:t;s&&(o.render=s,o.staticRenderFns=e,o._compiled=!0),i&&(o.functional=!0),r&&(o._scopeId="data-v-"+r);var n;if(a?(n=function(h){h=h||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!h&&typeof __VUE_SSR_CONTEXT__!="undefined"&&(h=__VUE_SSR_CONTEXT__),l&&l.call(this,h),h&&h._registeredComponents&&h._registeredComponents.add(a)},o._ssrRegister=n):l&&(n=d?function(){l.call(this,(o.functional?this.parent:this).$root.$options.shadowRoot)}:l),n)if(o.functional){o._injectStyles=n;var p=o.render;o.render=function(f,v){return n.call(v),p(f,v)}}else{var c=o.beforeCreate;o.beforeCreate=c?[].concat(c,n):[n]}return{exports:t,options:o}}const E={props:{sort:{type:String,default:""},activeSort:{type:String,default:""},sortOrders:{type:String,default:""}},data(){return{}},methods:{}},_={};var N=w(E,H,D,!1,W,null,null,null);function W(t){for(let s in _)this[s]=_[s]}var L=function(){return N.exports}(),O=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("i",{staticClass:"stability-table-open-icon",class:{"rotate-down":t.active}},[e("svg",{attrs:{viewBox:"64 64 896 896","data-icon":"right",width:"10",height:"10",fill:"currentColor","aria-hidden":"true",focusable:"false"}},[e("path",{attrs:{d:"M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"}})])])},M=[],st="";const K={props:{active:{type:Boolean,default:!1}}},y={};var A=w(K,O,M,!1,U,null,null,null);function U(t){for(let s in y)this[s]=y[s]}var I=function(){return A.exports}();const F=function(t){let s={};for(let e=0;e<t.length;e++){let i=t[e],l={key:i.name,value:i.value};s[l.key]=l.value}return s};let V=function(t){return t.target||(t.target=t.srcElement,t.pageX=t.x,t.pageY=t.y),/mouseover/i.test(t.type)&&!t.relatedTarget?t.relatedTarget=t.fromElement:/mouseout/i.test(t.type)&&!t.relatedTarget&&(t.relatedTarget=t.toElement),t};const P=(t,s)=>{const e=V(t),i=e.currentTarget;let l=e.target,r,a,d;for(;l&&l!==i;){if(r=l.getAttribute("event-agent")||"",r=r.trim().toLowerCase().split(","),r.indexOf(e.type.toLowerCase())!==-1){d=F(l.attributes),a=!0;break}l=l.parentNode}a&&s&&s(l,d)};var j=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"stability-table",class:{"not-user-select":t.dragSize.clientX}},[e("div",{ref:"tableBox",staticClass:"stability-table-wrapper"},[e("vueAgileScrollbar",{ref:"scroll",attrs:{dragSpeedY:.6,displayType:t.scrollDisplayType,offsetLeft:t.offsetLeft,offsetRight:t.offsetRight,offsetTop:t.offsetTop},on:{scroll:t.scroll,updated:t.scrollUpdated,"scroll-hit":t.scrollHit}},[e("table",{staticClass:"stability-wrapper-table",class:{"not-sticky":!t.stickyType,"not-sticky-left":t.stickyType==="left","not-sticky-right":t.stickyType==="right"},attrs:{cellpadding:"0",cellspacing:"0"},on:{click:t.tableClcik}},[e("thead",{ref:"tabelHead",staticClass:"stability-wrapper-table-head"},[e("tr",[t._l(t.head.left,function(i,l){return e("th",{key:i.prop,class:{"sticky-left":l===t.head.left.length-1},style:t.getSticky(i,l),attrs:{sticky:"left"}},[e("div",{staticClass:"stability-table-cell cell-flex",class:t.getCellClass(i).concat([{"sortable-column":i.sortable}]),on:{click:function(r){return t.sortChange(i)}}},[e("div",{staticClass:"text-content",attrs:{title:i.label}},[t._t("headerText",function(){return[t._v(t._s(i.label))]},{column:i})],2),i.sortable?e("Sort",{attrs:{sort:i.prop,sortOrders:t.sortOrders,activeSort:t.activeSort}}):t._e()],1),i.resizable&&i.width>0?e("span",{staticClass:"resize-handle",on:{mousedown:function(r){return t.dragSizeDown(r,i)}}}):t._e()])}),t.virtualScrollX?e("td",{style:{width:t.virtualScrollX.left+"px"}}):t._e(),t._l(t.cols,function(i){return e("th",{key:i.prop,style:t.getThStyle(i)},[e("div",{staticClass:"stability-table-cell cell-flex",class:t.getCellClass(i).concat([{"sortable-column":i.sortable}]),on:{click:function(l){return t.sortChange(i)}}},[e("div",{staticClass:"text-content",attrs:{title:i.label}},[t._t("headerText",function(){return[t._v(t._s(i.label))]},{column:i})],2),i.sortable?e("Sort",{attrs:{sort:i.prop,sortOrders:t.sortOrders,activeSort:t.activeSort}}):t._e()],1),i.resizable&&i.width>0?e("span",{staticClass:"resize-handle",on:{mousedown:function(l){return t.dragSizeDown(l,i)}}}):t._e()])}),t.virtualScrollX?e("td",{style:{width:t.virtualScrollX.right+"px"}}):t._e(),t._l(t.head.right,function(i,l){return e("th",{key:i.prop,class:{"sticky-right":l===0},style:t.getSticky(i,t.head.right.length-1-l),attrs:{sticky:"right"}},[e("div",{staticClass:"stability-table-cell cell-flex",class:t.getCellClass(i).concat([{"sortable-column":i.sortable}]),on:{click:function(r){return t.sortChange(i)}}},[e("div",{staticClass:"text-content",attrs:{title:i.label}},[t._t("headerText",function(){return[t._v(t._s(i.label))]},{column:i})],2),i.sortable?e("Sort",{attrs:{sort:i.prop,sortOrders:t.sortOrders,activeSort:t.activeSort}}):t._e()],1),i.resizable&&i.width>0?e("span",{staticClass:"resize-handle",on:{mousedown:function(r){return t.dragSizeDown(r,i)}}}):t._e()])})],2)]),e("tbody",[t.virtualScrollY?e("tr",{ref:"virtualTop",style:{height:t.virtualScrollY.top+"px"}}):t._e(),t._l(t.rows,function(i,l){return[e("tr",{key:i[t.rowKey],staticClass:"stability-wrapper-table-tbody-tr",on:{click:function(r){t.trClick(i,t.expandKey(l))}}},[t._l(t.head.left,function(r,a){return e("td",{key:r.prop,class:{"sticky-left":a===t.head.left.length-1},style:t.getSticky(r,a),attrs:{sticky:"left"}},[e("div",{staticClass:"stability-table-cell cell-flex",class:t.getCellClass(r)},[a===t.openIconColumn?e("span",{style:{width:i._treeIndex_*17+"px"}}):t._e(),a===t.openIconColumn&&i[t.childrenColumnName]&&i[t.childrenColumnName].length?e("open-icon",{attrs:{active:t.tree[i[t.rowKey]]},nativeOn:{click:function(d){t.treeOpen(i,t.expandKey(l))}}}):t._e(),t._t("content",function(){return[e("div",{staticClass:"text-content",attrs:{title:t.getContent(i,r),"event-agent":"click","row-index":t.expandKey(l),"col-index":a}},[t._v(" "+t._s(t.getContent(i,r))+" "),r.subProp?[e("br"),e("span",{staticClass:"sub-text-content"},[t._v(t._s(i[r.subProp]))])]:t._e()],2)]},{row:i,column:r,content:t.getContent(i,r),rowIndex:t.expandKey(l)})],2)])}),t.virtualScrollX?e("td"):t._e(),t._l(t.cols,function(r,a){return e("td",{key:r.prop},[e("div",{staticClass:"stability-table-cell",class:t.getCellClass(r)},[t._t("content",function(){return[e("div",{staticClass:"text-content",attrs:{title:t.getContent(i,r),"event-agent":"click","row-index":t.expandKey(l),"col-index":t.head.left.length+a+(t.virtualScrollX?t.virtualScrollX.start:0)}},[t._v(" "+t._s(t.getContent(i,r))+" "),r.subProp?[e("br"),e("span",{staticClass:"sub-text-content"},[t._v(t._s(i[r.subProp]))])]:t._e()],2)]},{row:i,column:r,content:t.getContent(i,r),rowIndex:t.expandKey(l)})],2)])}),t.virtualScrollX?e("td"):t._e(),t._l(t.head.right,function(r,a){return e("td",{key:r.prop,class:{"sticky-right":a===0},style:t.getSticky(r,t.head.right.length-1-a),attrs:{sticky:"right"}},[e("div",{staticClass:"stability-table-cell",class:t.getCellClass(r)},[t._t("content",function(){return[e("div",{staticClass:"text-content",attrs:{title:t.getContent(i,r),"event-agent":"click","row-index":t.expandKey(l),"col-index":t.head.left.length+t.head.middle.length+a}},[t._v(" "+t._s(t.getContent(i,r))+" "),r.subProp?[e("br"),e("span",{staticClass:"sub-text-content"},[t._v(t._s(i[r.subProp]))])]:t._e()],2)]},{row:i,column:r,content:t.getContent(i,r),rowIndex:t.expandKey(l)})],2)])})],2),t.expand&&t.expand[t.expandKey(l)]?e("tr",{key:i[t.rowKey]+"expand",ref:i[t.rowKey]+"expand",refInFor:!0},[e("td",{attrs:{colspan:t.columns.length}},[e("div",{staticClass:"tr-expand",style:{width:t.$refs.scroll.scrollWidth+"px"}},[t._t("expand",null,{row:i,rowIndex:t.expandKey(l)})],2)])]):t._e()]}),t.virtualScrollY?e("tr",{ref:"virtualBottom",style:{height:t.virtualScrollY.bottom+"px"}}):t._e()],2)])]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.dragSize.clientX,expression:"dragSize.clientX"}],ref:"dargSizeRuler",staticClass:"darg-size-ruler",style:{left:t.dragSize.rulerLeft+"px",height:t.dragSize.height+"px"}})],1)])},q=[],it="";const G={components:{vueAgileScrollbar:R,Sort:L,openIcon:I},props:g,mixins:[Y,T],data(){return{allRows:[],head:{left:[],middle:[],right:[]},rows:[],cols:[],expand:null,tree:{},virtualScrollX:null,virtualScrollY:null,offsetTop:0,stickyType:""}},watch:{columns(t){this.updateColumns(t)},dataSource(t){this.updateRows(t)}},computed:{offsetLeft(){let t=5;return this.head.left.forEach(s=>{t+=s.width>0?s.width:u.minWidth}),t},offsetRight(){let t=5;return this.head.right.forEach(s=>{t+=s.width>0?s.width:u.minWidth}),t}},created(){this.init()},mounted(){this.setOffsetTop()},methods:{init(){!this.dataSource.length||!this.columns.length||(this.setHead(),this.allRows=this.dataSource.slice(0),this.setVirtual(),this.setCols(0),this.setRows(0))},updateColumns(t){this.head={left:[],middle:[],right:[]},this.cols=[],this.setVirtual({colsNum:t.length}),this.setHead(t),this.setCols(0)},updateRows(){this.allRows=this.dataSource.slice(0),this.setVirtual({rowsNum:this.allRows.length}),this.setRows(0)},setVirtual(t={}){if(!this.virtual)this.virtual=new k({rowsNum:this.dataSource.length,colsNum:this.head.middle.length,rowSize:this.rowSize,colSize:this.colSize});else for(let s in t)this.virtual.opts[s]=t[s]},setHead(t){const s=t||this.columns;let e=[],i=[],l=[],r=s.length,a=null,d=null;for(let o=0;o<r;o++){const n=s[o];if(n.fixed)n.fixed="left",e.push(n);else{a=o;break}}for(let o=r-1;o>=0;o--){const n=s[o];if(n.fixed)n.fixed="right",l.unshift(n);else{d=o;break}}i=s.slice(a,d+1),this.head={left:e,middle:i,right:l},this.setOffsetTop()},setOffsetTop(){this.$refs.tabelHead&&(this.offsetTop=this.$refs.tabelHead.offsetHeight+5)},setRows(t){let s=this.virtual.getRowsRegion(t,this.expand);if(s){const e=s;this.rows=this.allRows.slice(e.start,e.end),this.virtualScrollY=e}else s===null&&(this.rows=this.allRows,this.virtualScrollY=null,this.virtual.emptyRowsRegion())},setCols(t){let s=this.virtual.getColRegion(t);s?(this.virtualScrollX=s,this.cols=this.head.middle.slice(this.virtualScrollX.start,this.virtualScrollX.end)):s===null&&(this.cols=this.head.middle)},getContent(t,s){let e=t[s.prop];return s.formatter&&typeof s.formatter=="function"&&e?s.formatter(e):e},getThStyle(t){return{width:(t.width>0?t.width:u.width)+"px"}},getCellClass(t){return[{left:"align-left",center:"align-center",right:"align-right"}[t.align||u.align]]},getSticky(t,s){let e=t;return t.fixed==="left"&&(e=s?this.head.left[s-1]:t),t.fixed==="right"&&(e=s?this.head.right[s]:t),{width:(t.width>0?t.width:u.width)+"px",[t.fixed]:s*(e.width||u.width)+"px"}},scroll(t){this.virtualScrollX&&this.setCols(t.left),(this.virtualScrollY||this.isUpdateRows)&&(this.setRows(t.top),this.isUpdateRows=!1),this.scrollTop=t.top},trClick(t,s){this.$scopedSlots.expand&&(this.expand||(this.expand={}),this.expand[s]?this.expand[s]=!1:this.$set(this.expand,s,!0),this.$nextTick(()=>{this.expand[s]&&(this.expand[s]=this.$refs[t[this.rowKey]+"expand"][0].offsetHeight)}),this.$emit("on-expand-change",t,this.expand[s]))},expandKey(t){return this.virtualScrollY?t+this.virtualScrollY.start:t},scrollUpdated(t){this.virtual&&(this.virtual.opts.viewHeight=t.scrollHeight,this.virtual.opts.viewWidth=t.scrollWidth),this.dragSize.height=t.scrollContentHeight>t.scrollHeight?t.scrollHeight:t.scrollContentHeight,t.scrollBarX?t.left===0&&(this.stickyType="left"):this.stickyType=""},scrollHit(t){this.stickyType=t},treeOpen(t,s){let e=t[this.rowKey],i=t[this.childrenColumnName];this.tree[e]?(this.tree[e]=!1,this.allRows.splice(s+1,i.length)):(this.$set(this.tree,e,!0),i.forEach(l=>{let r=t._treeIndex_;r?l._treeIndex_=r+1:l._treeIndex_=1}),this.allRows.splice(s+1,0,...i)),this.isUpdateRows=!0,this.virtual.opts.rowsNum=this.allRows.length,this.virtualScrollY?(this.virtualScrollY=this.virtual.upRowsRegion(this.expand),this.rows=this.allRows.slice(this.virtualScrollY.start,this.virtualScrollY.end)):this.rows=this.allRows},doLayout(){this.setOffsetTop(),this.$refs.scroll.updated()},tableClcik(t){this._events["cell-text-click"]&&P(t,(s,e)=>{const i=e["row-index"],l=e["col-index"];this.$emit("cell-text-click",this.columns[l],this.allRows[i],s)})}}},b={};var J=w(G,j,q,!1,Q,null,null,null);function Q(t){for(let s in b)this[s]=b[s]}var Z=function(){return J.exports}();return Z});
