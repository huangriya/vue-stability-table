(function(u,g){typeof exports=="object"&&typeof module!="undefined"?module.exports=g():typeof define=="function"&&define.amd?define(g):(u=typeof globalThis!="undefined"?globalThis:u||self,u["vue-stability-table"]=g())})(this,function(){"use strict";const u={label:"",prop:"",subProp:"",align:"left",fixed:!1,key:"",resizable:!1,width:100,minWidth:80,maxWidth:null,formatter:null,sortable:!1,className:""};var g={columns:{type:Array},dataSource:{type:Array},sticky:{type:Boolean,default:!1},childrenColumnName:{type:String,default:"children"},indentSize:{type:Number,default:16},defaultExpandAllRows:{type:Boolean,default:!1},pagination:{type:[Boolean,Object],default:!1},rowKey:{type:String,default:"id"},rowSize:{type:Number,default:40},colSize:{type:Number,default:100},emptyText:{type:String,default:"\u6682\u65E0\u6570\u636E"},openIconColumn:{type:Number,default:0},scrollDisplayType:{type:String,default:"show"},sortMark:{type:Boolean,default:!0},rowClassName:{type:Function},rowSelection:{type:Object,default(){return{selected:[],disabled:[]}}}},m={minBarSize:{type:Number,default:50},scrollTop:{type:Number,default:0},scrollLeft:{type:Number,default:0},displayType:{type:String,default:"hover"},offsetLeft:{type:Number,default:0},offsetRight:{type:Number,default:10},offsetTop:{type:Number,default:0},offsetBottom:{type:Number,default:10},isAutoUpdate:{type:Boolean,default:!0},dragSpeedX:{type:Number,default:1},dragSpeedY:{type:Number,default:1}},x=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{ref:"scrollBox",staticClass:"vue-agile-scrollbar",class:{"not-user-select":t.scrollBarX.clientX||t.scrollBarY.clientY,"scrollbar-hover":t.displayType==="hover","scrollbar-hide":t.displayType==="hide"}},[e("div",{ref:"scroll",staticClass:"agile-scroll-content",on:{scroll:t.onScroll}},[e("div",{ref:"scrollContent",staticClass:"agile-scroll-wrapper"},[t._t("default")],2)]),t.scrollBarX.show?e("div",{staticClass:"agile-scroll-bar-x",class:{act:t.scrollBarX.clientX},style:{left:t.scrollBarX.left+"px",width:t.scrollBarX.width+"px",bottom:t.scrollBarX.bottom},on:{mousedown:function(l){return t.scrollBarDown(l,"scrollBarX")}}}):t._e(),t.scrollBarY.show?e("div",{staticClass:"agile-scroll-bar-y",class:{act:t.scrollBarY.clientY},style:{top:t.scrollBarY.top+"px",height:t.scrollBarY.height+"px"},on:{mousedown:function(l){return t.scrollBarDown(l,"scrollBarY")}}}):t._e()])},B=[];function $(t,s,e,l,r,i,a,c){var o=typeof t=="function"?t.options:t;s&&(o.render=s,o.staticRenderFns=e,o._compiled=!0),l&&(o.functional=!0),i&&(o._scopeId="data-v-"+i);var n;if(a?(n=function(h){h=h||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!h&&typeof __VUE_SSR_CONTEXT__!="undefined"&&(h=__VUE_SSR_CONTEXT__),r&&r.call(this,h),h&&h._registeredComponents&&h._registeredComponents.add(a)},o._ssrRegister=n):r&&(n=c?function(){r.call(this,(o.functional?this.parent:this).$root.$options.shadowRoot)}:r),n)if(o.functional){o._injectStyles=n;var p=o.render;o.render=function(f,v){return n.call(v),p(f,v)}}else{var d=o.beforeCreate;o.beforeCreate=d?[].concat(d,n):[n]}return{exports:t,options:o}}const k={name:"vueAgileScrollBar",props:m,data(){return{scrollBarY:{show:!0,clientY:null,height:0,top:this.offsetTop,multiple:1},scrollBarX:{show:!0,clientX:null,width:0,bottom:0,left:this.offsetLeft,multiple:1},scrollWidth:0,scrollHeight:0,scrollContentWidth:0,scrollContentHeight:0}},watch:{offsetLeft(){this.setScrollBarLeft(),this.initScrollBar()},offsetRight(){this.initScrollBar()},offsetTop(){this.setScrollBarTop(),this.initScrollBar()},offsetBottom(){this.initScrollBar()}},mounted(){this.$scrollBox=this.$refs.scrollBox,this.$scroll=this.$refs.scroll,this.$scrollContent=this.$refs.scrollContent,this.setScrollLeft(),this.setScrollTop(),this.updated(),this.isAutoUpdate&&(this.observer=new MutationObserver(this.updated),this.observer.observe(this.$refs.scrollContent,{attributes:!0,childList:!0,subtree:!0})),this.addDragEvent()},methods:{initContainer(){this.scrollWidth=this.$scrollBox.offsetWidth,this.scrollHeight=this.$scrollBox.offsetHeight,this.scrollContentWidth=this.$scrollContent.offsetWidth,this.scrollContentHeight=this.$scrollContent.offsetHeight},initScrollBar(){if(this.scrollContentWidth>this.scrollWidth){const t=this.scrollWidth-(this.scrollContentWidth-this.scrollWidth)-this.offsetLeft-this.offsetRight;this.scrollBarX.show=!0,this.scrollBarX.width=t<this.minBarSize?this.minBarSize:t,this.scrollBarX.multiple=(this.scrollContentWidth-this.scrollWidth)/(this.scrollWidth-this.scrollBarX.width-this.offsetLeft-this.offsetRight)}else this.scrollBarX.show=!1;if(this.scrollContentHeight>this.scrollHeight){const t=this.scrollHeight-(this.scrollContentHeight-this.scrollHeight)-this.offsetTop-this.offsetBottom;this.scrollBarY.show=!0,this.scrollBarY.height=t<this.minBarSize?this.minBarSize:t,this.scrollBarY.multiple=(this.scrollContentHeight-this.scrollHeight)/(this.scrollHeight-this.scrollBarY.height-this.offsetTop-this.offsetBottom),this.scrollBarX.bottom=0}else this.scrollBarY.show=!1,this.scrollBarX.bottom=this.scrollHeight-this.scrollContentHeight+"px"},updated(){this.initContainer(),this.initScrollBar(),this.$emit("updated",{scrollBarY:this.scrollBarY.show,scrollBarX:this.scrollBarX.show,top:this.$scroll.scrollTop,left:this.$scroll.scrollLeft,scrollWidth:this.scrollWidth,scrollHeight:this.scrollHeight,scrollContentWidth:this.scrollContentWidth,scrollContentHeight:this.scrollContentHeight})},setScrollBarLeft(){const t=this.$scroll.scrollLeft,s=this.offsetLeft+Math.floor(t/this.scrollBarX.multiple);return s!==this.scrollBarX.left&&(this.scrollBarX.left=s),t},setScrollBarTop(){const t=this.$scroll.scrollTop,s=this.offsetTop+Math.floor(t/this.scrollBarY.multiple);return s!==this.scrollBarY.top&&(this.scrollBarY.top=s),t},onScroll(t){const s=this.setScrollBarTop(),e=this.setScrollBarLeft();this.$emit("scroll",{top:s,left:e,scrollWidth:this.scrollWidth,scrollHeight:this.scrollHeight,scrollContentWidth:this.scrollContentWidth,scrollContentHeight:this.scrollContentHeight},t),this._events["scroll-hit"]&&this.onScrollHit(s,e)},onScrollHit(t,s){let e="top",l=t-this.initTop,r=s-this.initLeft;this.initTop=t,this.initLeft=s;const i=()=>{this.$emit("scroll-hit",e,{top:t,left:s,scrollWidth:this.scrollWidth,scrollHeight:this.scrollHeight,scrollContentWidth:this.scrollContentWidth,scrollContentHeight:this.scrollContentHeight})};l!==0&&this.scrollBarY.height&&(l<0?e="top":e="bottom",this.scrollContentHeight-this.scrollHeight-t==0&&i(),t===0&&e==="top"&&i()),r!==0&&this.scrollBarX.width&&(r<0?e="left":e="right",s===0&&e==="left"||this.scrollContentWidth-this.scrollWidth-s==0||(e="xMiddle"),i())},scrollBarDown(t,s){s==="scrollBarX"&&(this.scrollBarX.clientX=t.clientX,this.scrollBarX.scrollLeft=this.$scroll.scrollLeft),s==="scrollBarY"&&(this.scrollBarY.clientY=t.clientY,this.scrollBarY.scrollTop=this.$scroll.scrollTop),window.addEventListener("mousemove",this.scrollBarDrag)},scrollBarDrag(t){const s=this.scrollBarX.clientX,e=this.scrollBarY.clientY;if(s){let l=t.clientX-s;this.$scroll.scrollLeft=this.scrollBarX.scrollLeft+l*(this.scrollBarX.multiple*this.dragSpeedX)}if(e){let l=t.clientY-e;this.$scroll.scrollTop=this.scrollBarY.scrollTop+l*this.scrollBarY.multiple*this.dragSpeedY}},scrollBarUp(){this.scrollBarX.clientX=null,this.scrollBarY.clientY=null,window.removeEventListener("mousemove",this.scrollBarDrag)},addDragEvent(){window.addEventListener("mouseup",this.scrollBarUp)},removeDragEvent(){window.removeEventListener("mouseup",this.addDragEvent)},setScrollLeft(t){(t>=0||this.scrollLeft>=0)&&(this.$scroll.scrollLeft=t||this.scrollLeft)},setScrollTop(t){(t>=0||this.scrollTop>=0)&&(this.$scroll.scrollTop=t||this.scrollTop)}},beforeDestroy(){this.isAutoUpdate&&this.observer&&this.observer.disconnect(),this.removeDragEvent()}},S={};var z=$(k,x,B,!1,R,null,null,null);function R(t){for(let s in S)this[s]=S[s]}var X=function(){return z.exports}(),at="";class T{constructor(s){this.opts=Object.assign({},{rowsNum:0,colsNum:0,rowSize:50,colSize:100,expandSize:null,fixedColNum:0,viewHeight:500,viewWidth:800},s),this.topDistance=0,this.rowStart=null,this.rowEnd=null,this.bottomDistance=0,this.leftDistance=0,this.colStart=null,this.colEnd=null,this.rightDistance=0,this.scrollTop=0,this.scrollLeft=0}getRowsRegion(s,e){if(this.opts.rowsNum<=50)return null;let l,r,i={top:0,middle:0,bottom:0};const a=this.opts.rowsNum,c=this.opts.rowSize,o=this.opts.viewHeight,n=Math.ceil(o/c);if(e){let p=this.topDistance;if(s>this.scrollTop){for(let d=this.rowStart||0;d<a;d++)if(p+=c+(e&&e[d]||0),p>=s){l=d,r=l+n;break}}if(s<this.scrollTop&&p>=s){let d=0;for(let f=this.rowStart;f<this.rowEnd;f++)d+=c+(e&&e[f]||0);let h=0;for(const f in e)f<this.rowEnd&&(h+=e[f]);r=Math.floor((s+d-h)/c),r<n&&(r=n),l=r-n}for(const d in e)d<l?i.top+=e[d]:d>r&&(i.bottom+=e[d])}else l=Math.floor(s/c),r=l+n;if(r>a&&(r=a),l<0&&(l=0),l!==void 0&&r!==void 0&&(l!==this.rowStart||r!==this.rowEnd))return this.scrollTop=s,this.rowStart=l,this.rowEnd=r,this.topDistance=this.rowStart*this.opts.rowSize+i.top,this.bottomDistance=(a-this.rowEnd)*this.opts.rowSize+i.bottom,{start:this.rowStart,end:this.rowEnd,top:this.topDistance,bottom:this.bottomDistance}}upRowsRegion(){const s=this.opts.rowsNum;return this.topDistance=this.rowStart*this.opts.rowSize,this.bottomDistance=(s>this.rowEnd?s-this.rowEnd:0)*this.opts.rowSize,{start:this.rowStart,end:this.rowEnd,top:this.topDistance,bottom:this.bottomDistance}}emptyRowsRegion(){this.rowStart=null,this.rowEnd=null}getColRegion(s){const e=this.opts.colSize,l=Math.floor(this.opts.viewWidth/e);if(this.opts.colsNum<=30)return null;let r,i,a;if(s<this.opts.viewWidth)r=0,i=l*2;else{r=Math.floor(s/e)-l;let c=r+l*3;i=c,c>this.opts.colsNum&&(i=this.opts.colsNum,this.rightDistance=0,a=!0)}if(this.scrollLeft=s,(r!==this.colStart||i!==this.colEnd)&&i-this.colEnd>5||this.colEnd-i>5||a)return this.colStart=r,this.colEnd=i,this.leftDistance=this.colStart*e,this.rightDistance=(this.opts.colsNum-this.colEnd)*e,{start:this.colStart,end:this.colEnd,left:this.leftDistance,right:this.rightDistance}}}var Y={data(){return{dragSize:{clientX:null,dWidth:0,height:0,rulerLeft:0,colItem:null}}},mounted(){this.addDragEvent()},methods:{dragSizeDown(t,s){this.dragSize.rulerLeft=t.clientX-this.$refs.tableBox.getBoundingClientRect().x,this.dragSize.height=this.$refs.scroll.scrollHeight,this.dragSize.clientX=t.clientX,this.dragSize.width=s.width,this.dragSize.colItem=s,this.dragSize.element=t.target,window.addEventListener("mousemove",this.dragSizeMove),this.dragSize.element.setAttribute("data-darg-act","true")},dragSizeMove(t){const s=this.dragSize.clientX;if(s){let e=t.clientX-s;this.dragSize.dWidth=e,this.$refs.dargSizeRuler.style.left=this.dragSize.rulerLeft+e+"px"}},dragSizeUp(){if(this.dragSize.clientX){this.dragSize.clientX=null,this.dragSize.element.setAttribute("data-darg-act","false");const t=this.dragSize.colItem.minWidth||u.minWidth;let s=this.dragSize.width+this.dragSize.dWidth;s<t&&(s=t),this.dragSize.colItem.width=s,window.removeEventListener("mousemove",this.dragSizeMove),this.$emit("resize-column",this.dragSize.colItem)}},addDragEvent(){window.addEventListener("mouseup",this.dragSizeUp)},removeDragEvent(){window.removeEventListener("mouseup",this.dragSizeUp)}},beforeDestroy(){this.removeDragEvent()}},E={data(){return{activeSort:"",sortOrders:""}},methods:{getActSortClass(t){return!!(this.sortMark&&t.sortable&&t.prop===this.activeSort)},sortChange(t){if(t.sortable)if(!this.activeSort||!this.sortOrders||this.sortOrders==="desc"||t.prop!==this.activeSort?this.sortOrders="asc":this.sortOrders==="asc"&&(this.sortOrders="desc"),this.activeSort=t.prop,this._events["on-sort-change"])this.$emit("on-sort-change",t.prop,this.sortOrders,t);else{let s=this.dataSource.slice(0);this.sortOrders&&s.sort((e,l)=>{let r=e[t.prop],i=l[t.prop];return r===i?0:typeof r==typeof i&&this.sortOrders==="asc"?r<i?-1:1:r>i?-1:1}),this.tree={},this.allRows=s,this.$refs.scroll.setScrollTop(0),this.virtualScrollY?(this.virtualScrollY=this.virtual.upRowsRegion(this.expand),this.rows=s.slice(this.virtualScrollY.start,this.virtualScrollY.end)):this.rows=s}}}},H=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("span",{staticClass:"stability-table-column-sorter"},[e("span",{staticClass:"stability-table-column-sorter-inner"},[e("span",{staticClass:"stability-table-column-sorter-up",class:{"sort-act":t.sort&&t.activeSort&&t.sort===t.activeSort&&t.sortOrders==="asc"},attrs:{role:"img"}},[e("svg",{attrs:{focusable:"false",width:"11",height:"11",fill:"currentColor","aria-hidden":"true",viewBox:"0 0 1024 1024"}},[e("path",{attrs:{d:"M858.9 689L530.5 308.2c-9.4-10.9-27.5-10.9-37 0L165.1 689c-12.2 14.2-1.2 35 18.5 35h656.8c19.7 0 30.7-20.8 18.5-35z"}})])]),e("span",{staticClass:"stability-table-column-sorter-down",class:{"sort-act":t.sort&&t.activeSort&&t.sort===t.activeSort&&t.sortOrders==="desc"},attrs:{role:"img"}},[e("svg",{attrs:{focusable:"false",width:"11",height:"11",fill:"currentColor","aria-hidden":"true",viewBox:"0 0 1024 1024"}},[e("path",{attrs:{d:"M840.4 300H183.6c-19.7 0-30.7 20.8-18.5 35l328.4 380.8c9.4 10.9 27.5 10.9 37 0L858.9 335c12.2-14.2 1.2-35-18.5-35z"}})])])])])},N=[],nt="";function _(t,s,e,l,r,i,a,c){var o=typeof t=="function"?t.options:t;s&&(o.render=s,o.staticRenderFns=e,o._compiled=!0),l&&(o.functional=!0),i&&(o._scopeId="data-v-"+i);var n;if(a?(n=function(h){h=h||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!h&&typeof __VUE_SSR_CONTEXT__!="undefined"&&(h=__VUE_SSR_CONTEXT__),r&&r.call(this,h),h&&h._registeredComponents&&h._registeredComponents.add(a)},o._ssrRegister=n):r&&(n=c?function(){r.call(this,(o.functional?this.parent:this).$root.$options.shadowRoot)}:r),n)if(o.functional){o._injectStyles=n;var p=o.render;o.render=function(f,v){return n.call(v),p(f,v)}}else{var d=o.beforeCreate;o.beforeCreate=d?[].concat(d,n):[n]}return{exports:t,options:o}}const D={props:{sort:{type:String,default:""},activeSort:{type:String,default:""},sortOrders:{type:String,default:""}},data(){return{}},methods:{}},y={};var L=_(D,H,N,!1,W,null,null,null);function W(t){for(let s in y)this[s]=y[s]}var M=function(){return L.exports}(),O=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("i",{staticClass:"stability-table-open-icon",class:{"rotate-down":t.active}},[e("svg",{attrs:{viewBox:"64 64 896 896","data-icon":"right",width:"10",height:"10",fill:"currentColor","aria-hidden":"true",focusable:"false"}},[e("path",{attrs:{d:"M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"}})])])},A=[],ct="";const K={props:{active:{type:Boolean,default:!1}}},b={};var I=_(K,O,A,!1,U,null,null,null);function U(t){for(let s in b)this[s]=b[s]}var F=function(){return I.exports}();const V=function(t){let s={};for(let e=0;e<t.length;e++){let l=t[e],r={key:l.name,value:l.value};s[r.key]=r.value}return s};let P=function(t){return t.target||(t.target=t.srcElement,t.pageX=t.x,t.pageY=t.y),/mouseover/i.test(t.type)&&!t.relatedTarget?t.relatedTarget=t.fromElement:/mouseout/i.test(t.type)&&!t.relatedTarget&&(t.relatedTarget=t.toElement),t};const j=(t,s)=>{const e=P(t),l=e.currentTarget;let r=e.target,i,a,c;for(;r&&r!==l;){if(i=r.getAttribute("event-agent")||"",i=i.trim().toLowerCase().split(","),i.indexOf(e.type.toLowerCase())!==-1){c=V(r.attributes),a=!0;break}r=r.parentNode}a&&s&&s(r,c)};var q=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("span",{staticClass:"stability-table-checkbox",class:{"stability-table-checkbox-checked":t.value,"surely-table-checkbox-disabled":t.disabled,"surely-table-checkbox-indeterminate":!t.value&&t.indeterminate},on:{click:function(l){return t.change()}}},[e("input",{staticClass:"stability-table-checkbox-input",attrs:{type:"checkbox",disabled:t.disabled},domProps:{checked:t.value}}),e("span",{staticClass:"stability-table-checkbox-inner"})])},G=[],ht="";const J={props:{value:{type:[Boolean,Number],default:!1},disabled:{type:[Boolean,Number]},indeterminate:{type:Boolean}},created(){},methods:{change(){this.disabled||this.$emit("change",!this.value)}}},w={};var Q=_(J,q,G,!1,Z,null,null,null);function Z(t){for(let s in w)this[s]=w[s]}var tt=function(){return Q.exports}(),et=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"stability-table",class:{"not-user-select":t.dragSize.clientX}},[e("div",{ref:"tableBox",staticClass:"stability-table-wrapper"},[e("vueAgileScrollbar",{ref:"scroll",attrs:{dragSpeedY:.6,displayType:t.scrollDisplayType,offsetLeft:t.offsetLeft,offsetRight:t.offsetRight,offsetTop:t.offsetTop},on:{scroll:t.scroll,updated:t.scrollUpdated,"scroll-hit":t.scrollHit}},[e("table",{staticClass:"stability-wrapper-table",class:{"not-sticky":!t.stickyType,"not-sticky-left":t.stickyType==="left","not-sticky-right":t.stickyType==="right"},attrs:{cellpadding:"0",cellspacing:"0"},on:{click:t.tableClcik}},[e("thead",{ref:"tabelHead",staticClass:"stability-wrapper-table-head"},[e("tr",[t._l(t.head.left,function(l,r){return e("th",{key:l.prop,class:[{"sticky-left":r===t.head.left.length-1},l.className,{"act-sort":t.getActSortClass(l)}],style:t.getSticky(l,r),attrs:{sticky:"left"}},[e("div",{staticClass:"stability-table-cell cell-flex",class:t.getCellClass(l).concat([{"sortable-column":l.sortable}]),on:{click:function(i){return t.sortChange(l)}}},[l.type==="selection"?e("checkbox",{attrs:{value:t.selectAll,indeterminate:t.indeterminate},on:{change:t.selectAllChange}}):t._t("header",function(){return[e("div",{staticClass:"text-content",attrs:{title:l.label}},[t._v(" "+t._s(l.label)+" ")])]},{column:l}),l.sortable?e("Sort",{attrs:{sort:l.prop,sortOrders:t.sortOrders,activeSort:t.activeSort}}):t._e()],2),l.resizable&&l.width>0?e("span",{staticClass:"resize-handle",on:{mousedown:function(i){return t.dragSizeDown(i,l)}}}):t._e()])}),t.virtualScrollX?e("td",{style:{width:t.virtualScrollX.left+"px"}}):t._e(),t._l(t.cols,function(l){return e("th",{key:l.prop,class:[l.className,{"act-sort":t.getActSortClass(l)}],style:t.getThStyle(l)},[e("div",{staticClass:"stability-table-cell cell-flex",class:t.getCellClass(l).concat([{"sortable-column":l.sortable}]),on:{click:function(r){return t.sortChange(l)}}},[l.type==="selection"?e("checkbox",{attrs:{value:t.selectAll},on:{change:t.selectAllChange}}):t._t("header",function(){return[e("div",{staticClass:"text-content",attrs:{title:l.label}},[t._v(" "+t._s(l.label)+" ")])]},{column:l}),l.sortable?e("Sort",{attrs:{sort:l.prop,sortOrders:t.sortOrders,activeSort:t.activeSort}}):t._e()],2),l.resizable&&l.width>0?e("span",{staticClass:"resize-handle",on:{mousedown:function(r){return t.dragSizeDown(r,l)}}}):t._e()])}),t.virtualScrollX?e("td",{style:{width:t.virtualScrollX.right+"px"}}):t._e(),t._l(t.head.right,function(l,r){return e("th",{key:l.prop,class:[{"sticky-right":r===0},l.className,{"act-sort":t.getActSortClass(l)}],style:t.getSticky(l,t.head.right.length-1-r),attrs:{sticky:"right"}},[e("div",{staticClass:"stability-table-cell cell-flex",class:t.getCellClass(l).concat([{"sortable-column":l.sortable}]),on:{click:function(i){return t.sortChange(l)}}},[t._t("header",function(){return[e("div",{staticClass:"text-content",attrs:{title:l.label}},[t._v(" "+t._s(l.label)+" ")])]},{column:l}),l.sortable?e("Sort",{attrs:{sort:l.prop,sortOrders:t.sortOrders,activeSort:t.activeSort}}):t._e()],2),l.resizable&&l.width>0?e("span",{staticClass:"resize-handle",on:{mousedown:function(i){return t.dragSizeDown(i,l)}}}):t._e()])})],2)]),e("tbody",[t.virtualScrollY?e("tr",{ref:"virtualTop",style:{height:t.virtualScrollY.top+"px"}}):t._e(),t._l(t.rows,function(l,r){return[e("tr",{key:l[t.rowKey],staticClass:"stability-wrapper-table-tbody-tr",class:{"table-children-row":l._treeIndex_},on:{click:function(i){t.trClick(l,t.expandKey(r))}}},[t._l(t.head.left,function(i,a){return e("td",{key:i.prop,class:[{"sticky-left":a===t.head.left.length-1},i.className,{"act-sort":t.getActSortClass(i)}],style:t.getSticky(i,a),attrs:{sticky:"left"}},[i.type==="selection"?e("div",{staticClass:"stability-table-cell cell-flex",class:t.getCellClass(i)},[l._treeIndex_?t._e():e("checkbox",{attrs:{value:t.selectedMap[l[t.rowKey]],disabled:t.selectedDsbMap[l[t.rowKey]]},on:{change:function(c){return t.selectedChange(c,l)}}})],1):e("div",{staticClass:"stability-table-cell cell-flex",class:t.getCellClass(i)},[a===t.openIconColumn?e("span",{style:{width:l._treeIndex_*t.indentSize+"px"}}):t._e(),a===t.openIconColumn&&l[t.childrenColumnName]&&l[t.childrenColumnName].length?e("open-icon",{attrs:{active:t.tree[l[t.rowKey]]},nativeOn:{click:function(c){t.treeOpen(l,t.expandKey(r))}}}):t._e(),t._t("content",function(){return[e("div",{staticClass:"text-content",attrs:{title:t.getContent(l,i),"event-agent":"click","row-index":t.expandKey(r),"col-index":a}},[t._v(" "+t._s(t.getContent(l,i))+" "),i.subProp?[e("br"),e("span",{staticClass:"sub-text-content"},[t._v(t._s(l[i.subProp]))])]:t._e()],2)]},{row:l,column:i,content:t.getContent(l,i),rowIndex:t.expandKey(r)})],2)])}),t.virtualScrollX?e("td"):t._e(),t._l(t.cols,function(i,a){return e("td",{key:i.prop,class:[i.className,{"act-sort":t.getActSortClass(i)}]},[i.type==="selection"?e("div",{staticClass:"stability-table-cell cell-flex",class:t.getCellClass(i)},[e("checkbox",{attrs:{value:t.selectedMap[l[t.rowKey]],disabled:t.selectedDsbMap[l[t.rowKey]]},on:{change:function(c){return t.selectedChange(c,l)}}})],1):e("div",{staticClass:"stability-table-cell",class:t.getCellClass(i)},[t._t("content",function(){return[e("div",{staticClass:"text-content",attrs:{title:t.getContent(l,i),"event-agent":"click","row-index":t.expandKey(r),"col-index":t.head.left.length+a+(t.virtualScrollX?t.virtualScrollX.start:0)}},[t._v(" "+t._s(t.getContent(l,i))+" "),i.subProp?[e("br"),e("span",{staticClass:"sub-text-content"},[t._v(t._s(l[i.subProp]))])]:t._e()],2)]},{row:l,column:i,content:t.getContent(l,i),rowIndex:t.expandKey(r)})],2)])}),t.virtualScrollX?e("td"):t._e(),t._l(t.head.right,function(i,a){return e("td",{key:i.prop,class:[{"sticky-right":a===0},i.className,{"act-sort":t.getActSortClass(i)}],style:t.getSticky(i,t.head.right.length-1-a),attrs:{sticky:"right"}},[e("div",{staticClass:"stability-table-cell",class:t.getCellClass(i)},[t._t("content",function(){return[e("div",{staticClass:"text-content",attrs:{title:t.getContent(l,i),"event-agent":"click","row-index":t.expandKey(r),"col-index":t.head.left.length+t.head.middle.length+a}},[t._v(" "+t._s(t.getContent(l,i))+" "),i.subProp?[e("br"),e("span",{staticClass:"sub-text-content"},[t._v(t._s(l[i.subProp]))])]:t._e()],2)]},{row:l,column:i,content:t.getContent(l,i),rowIndex:t.expandKey(r)})],2)])})],2),t.expand&&t.expand[t.expandKey(r)]?e("tr",{key:l[t.rowKey]+"expand",ref:l[t.rowKey]+"expand",refInFor:!0},[e("td",{attrs:{colspan:t.columns.length}},[e("div",{staticClass:"tr-expand",style:{width:t.$refs.scroll.scrollWidth+"px"}},[t._t("expand",null,{row:l,rowIndex:t.expandKey(r)})],2)])]):t._e()]}),t.virtualScrollY?e("tr",{ref:"virtualBottom",style:{height:t.virtualScrollY.bottom+"px"}}):t._e()],2)])]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.dragSize.clientX,expression:"dragSize.clientX"}],ref:"dargSizeRuler",staticClass:"darg-size-ruler",style:{left:t.dragSize.rulerLeft+"px",height:t.dragSize.height+"px"}})],1)])},st=[],dt="";const lt={components:{vueAgileScrollbar:X,Sort:M,openIcon:F,checkbox:tt},props:g,mixins:[Y,E],data(){return{allRows:[],head:{left:[],middle:[],right:[]},rows:[],cols:[],expand:null,tree:{},virtualScrollX:null,virtualScrollY:null,offsetTop:0,stickyType:"",selectAll:!1,selectedMap:{},selectedDsbMap:{}}},watch:{columns(t){this.updateColumns(t)},dataSource(t){this.updateRows(t)}},computed:{offsetLeft(){let t=5;return this.head.left.forEach(s=>{t+=s.width>0?s.width:u.minWidth}),t},offsetRight(){let t=5;return this.head.right.forEach(s=>{t+=s.width>0?s.width:u.minWidth}),t},indeterminate(){return!1}},created(){this.init()},mounted(){this.setOffsetTop()},methods:{init(){!this.dataSource.length||!this.columns.length||(this.setHead(),this.allRows=this.dataSource.slice(0),this.setVirtual(),this.selectInit(),this.setCols(0),this.setRows(0))},updateColumns(t){this.$refs.scroll.setScrollLeft(0),this.head={left:[],middle:[],right:[]},this.cols=[],this.setVirtual({colsNum:t.length}),this.setHead(t),this.setCols(0)},updateRows(t){const s=t||this.dataSource;this.$refs.scroll.setScrollTop(0),this.allRows=s.slice(0),this.setVirtual({rowsNum:this.allRows.length}),this.setRows(0)},setVirtual(t={}){if(!this.virtual)this.virtual=new T({rowsNum:this.dataSource.length,colsNum:this.head.middle.length,rowSize:this.rowSize,colSize:this.colSize});else for(let s in t)this.virtual.opts[s]=t[s]},setHead(t){const s=t||this.columns;let e=[],l=[],r=[],i=s.length,a=null,c=null;for(let o=0;o<i;o++){const n=s[o];if(n.fixed)n.fixed="left",e.push(n);else{a=o;break}}for(let o=i-1;o>=0;o--){const n=s[o];if(n.fixed)n.fixed="right",r.unshift(n);else{c=o;break}}l=s.slice(a,c+1),this.head={left:e,middle:l,right:r},this.setOffsetTop()},setOffsetTop(){this.$refs.tabelHead&&(this.offsetTop=this.$refs.tabelHead.offsetHeight+5)},setRows(t){let s=this.virtual.getRowsRegion(t,this.expand);if(s){const e=s;this.rows=this.allRows.slice(e.start,e.end),this.virtualScrollY=e}else s===null&&(this.rows=this.allRows,this.virtualScrollY=null,this.virtual.emptyRowsRegion())},setCols(t){let s=this.virtual.getColRegion(t);s?(this.virtualScrollX=s,this.cols=this.head.middle.slice(this.virtualScrollX.start,this.virtualScrollX.end)):s===null&&(this.cols=this.head.middle)},getContent(t,s){let e=t[s.prop];return s.formatter&&typeof s.formatter=="function"&&e?s.formatter(e):e},getThStyle(t){return{width:(t.width>0?t.width:u.width)+"px"}},getCellClass(t){return[{left:"align-left",center:"align-center",right:"align-right"}[t.align||u.align]]},getSticky(t,s){let e={left:0,right:0};if(t.fixed==="left")for(let i=0;i<s;i++)e.left+=this.head.left[i].width||u.width;if(t.fixed==="right")for(let i=0;i<s;i++)e.right+=this.head.right[i].width||u.width;return{width:(t.width>0?t.width:u.width)+"px",[t.fixed]:e[t.fixed]+"px"}},scroll(t){this.virtualScrollX&&this.setCols(t.left),(this.virtualScrollY||this.isUpdateRows)&&(this.setRows(t.top),this.isUpdateRows=!1),this.scrollTop=t.top,this.$emit("scroll",...arguments)},trClick(t,s){this.$scopedSlots.expand&&(this.expand||(this.expand={}),this.expand[s]?this.expand[s]=!1:this.$set(this.expand,s,!0),this.$nextTick(()=>{this.expand[s]&&(this.expand[s]=this.$refs[t[this.rowKey]+"expand"][0].offsetHeight)}),this.$emit("on-expand-change",t,this.expand[s]))},expandKey(t){return this.virtualScrollY?t+this.virtualScrollY.start:t},scrollUpdated(t){this.virtual&&(t.scrollHeight&&(this.virtual.opts.viewHeight=t.scrollHeight),t.scrollWidth&&(this.virtual.opts.viewWidth=t.scrollWidth)),this.dragSize.height=t.scrollContentHeight>t.scrollHeight?t.scrollHeight:t.scrollContentHeight,t.scrollBarX?t.left===0&&(this.stickyType="left"):this.stickyType=""},scrollHit(t){this.stickyType=t,this.$emit("scroll-hit",...arguments)},treeOpen(t,s){let e=t[this.rowKey],l=t[this.childrenColumnName];this.tree[e]?(this.tree[e]=!1,this.allRows.splice(s+1,l.length)):(this.$set(this.tree,e,!0),l.forEach(r=>{let i=t._treeIndex_;i?r._treeIndex_=i+1:r._treeIndex_=1}),this.allRows.splice(s+1,0,...l)),this.isUpdateRows=!0,this.virtual.opts.rowsNum=this.allRows.length,this.virtualScrollY?(this.virtualScrollY=this.virtual.upRowsRegion(this.expand),this.rows=this.allRows.slice(this.virtualScrollY.start,this.virtualScrollY.end)):this.rows=this.allRows},doLayout(){this.setOffsetTop(),this.$refs.scroll.updated()},tableClcik(t){this._events["cell-text-click"]&&j(t,(s,e)=>{const l=e["row-index"],r=e["col-index"];this.$emit("cell-text-click",this.columns[r],this.allRows[l],s)})},selectInit(){this.rowSelection&&this.rowSelection.selected&&this.rowSelection.selected.forEach(t=>{this.$set(this.selectedMap,t,1)}),this.rowSelection&&this.rowSelection.disabled&&this.rowSelection.disabled.forEach(t=>{this.$set(this.selectedDsbMap,t,1)})},selectAllChange(t){this.selectAll=t,this.allRows.forEach(s=>{this.selectedDsbMap[s[this.rowKey]]||this.$set(this.selectedMap,s[this.rowKey],t?1:0)}),this.$emit("selection-change",{checked:t,rows:this.getSelectionRows()})},selectedChange(t,s){this.$set(this.selectedMap,s[this.rowKey],t?1:0),this.$emit("selection-change",{checked:t,row:s,rows:this.getSelectionRows()})},getSelectionRows(){return this.allRows.filter(t=>{if(this.selectedMap[t[this.rowKey]])return t})},setSelectionRows(t=[]){t.forEach(s=>{this.$set(this.selectedMap,s,1)})}}},C={};var it=_(lt,et,st,!1,rt,null,null,null);function rt(t){for(let s in C)this[s]=C[s]}var ot=function(){return it.exports}();return ot});
